<html>
<head>
<title>gosim log viewer</title>
<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.3/dist/htmx.min.js" integrity="sha256-SRlVzRgQdH19e5zLk2QAr7dg4G0l1T5FcrZLZWOyeE4=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha256-whL0tQWoY1Ku1iskqPFvmZ+CHsvmRWx/PIoEvIeWh4I=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/tippy.js@6.3.7/dist/tippy.umd.min.js" integrity="sha256-qx7gQMlSzXvTJCl8PBcHyzDQLGvX7NaFbiFY44WpsW4=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tippy.js@6.3.7/dist/tippy.min.css">
<style>
.selected {
    background-color: #F37736;
}
a {
    color: black;
}
</style>
</head>
<body>
<div style="display: flex; overflow: hide; height: 100%">
    <div style="width: 50%; display: flex; flex-direction: column;">
        <div>
            <pre>focus: {{ if .Focus }}{{ .Focus }} <a href="/">all logs</a>{{ else }}all logs{{ end }}</pre>
        </div>
        <div style="overflow: scroll; font-family: monospace;">
{{ range .Logs }}
    <span>
        {{ .Step }}
        <a href="/?focus=machine:{{ .Machine }}">{{ .Machine }}</a>/<a href="/?focus=goroutine:{{ .Goroutine }}">{{.Goroutine}}</a>
        {{.Time | Time }}
        {{ .Level }}
        <a href="#" onclick="show({index: {{ .Index }}, source: {{ .Source }} })">{{ .Source | Source }}</a>
        &gt;
        <pre style="display: inline">{{ .Msg }}</pre>
    </span><br>
{{ end }}
        </div>
    </div>
    <div style="width: 50%; display: flex; flex-direction: column;">
        <div id="source" style="height: 50%; overflow: scroll">
        </div>
        <div id="stack" style="height: 50%; overflow: scroll">
        </div>
    </div>
</div>
<script>
var curFile = undefined;
function show(opts) {
    if (opts.index !== undefined) {
        htmx.ajax("GET", "/stack?index=" + opts.index, "#stack");
    }
    if (opts.source !== undefined) {
        htmx.ajax("GET", "/viewer?file=" + encodeURIComponent(opts.source.file) + "&line=" + opts.source.line, "#source");
    }
}
function scrollTo(file, line) {
    var element = document.getElementById("L"+line);
    var newFile = file;
    if (newFile !== curFile) {
        curFile = newFile;
        element.scrollIntoView({block: "center"});
    } else {
        element.scrollIntoViewIfNeeded({block: "center"});
    }
}
htmx.onLoad(function(e) {
    tippy(e.querySelectorAll('[data-tooltip]'), {
        duration: 0,
        maxWidth: "none",
        content: function(e) { return e.getAttribute('data-tooltip'); },
    });
});
</script>
</body>
</html>